<html>
<head>
	    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="stylesheet" href="http://static.bbci.co.uk/frameworks/barlesque/2.59.10/desktop/3.5/style/main.css"><link rel="stylesheet" href="http://static.bbci.co.uk/weather/0.5.276/css/core.css">




 <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyASm3CwaK9qtcZEWYa-iQwHaGi3gcosAJc&sensor=false"></script>

<script type="text/javascript">


var styled = [
    {
        "stylers": [
            {
                "hue": "#ff1a00"
            },
            {
                "invert_lightness": true
            },
            {
                "saturation": -100
            },
            {
                "lightness": 33
            },
            {
                "gamma": 0.5
            }
        ]
    },
    {
        "featureType": "water",
        "elementType": "geometry",
        "stylers": [
            {
                "color": "#2D333C"
            }
        ]
    }
]


        function addMarker(bus) {
                  var marker = new google.maps.Marker({
                       position: new google.maps.LatLng(bus.lat, bus.long),
                       map: map,
                       icon: '/bus.png',
                       title: bus.currentLocation + '' + bus.registration
                   });
                  map.markers.push(marker);



                }



            google.maps.event.addDomListener(window, 'load', init);

            var clearMarkers, map;

            function init() {
                var mapOptions = {
                    zoom: 15,

                     disableDefaultUI: false, // a way to quickly hide all controls
                    mapTypeControl: false,
                      streetViewControl:false,
                    scaleControl: false,
                    zoomControl: false,
                    center: new google.maps.LatLng(51.6067182,0.03675780000003215), // My House

                    styles: styled
                };

                // Get the HTML DOM element that will contain your map
                // We are using a div with id="map" seen below in the <body>
                var mapElement = document.getElementById('map');
                console.log('ME', mapElement)

                // Create the Google Map using out element and options defined above
                map = new google.maps.Map(mapElement, mapOptions);


                var marker = new google.maps.Marker({
                     position: new google.maps.LatLng(51.6067182,0.03675780000003215),
                     map: map,
                     title: '2a Danbury Way'
                 });





                map.markers = [];


                function clearMarkers() {

                   var c = map.markers.length;
                   while(c--) {
                    console.log(map.markers[c])
                   }

                }

}



        </script>

</head>

<link rel="stylesheet" type="text/css" href="/style.css">
<style>



</style>

<head>
<title>Status</title>
</head>
<body class="up">
	<div id="widgets">
	</div>
<script src="/socket.io/socket.io.js"></script>
<script src="/jquery.js"></script>
<script>
  var socket = io.connect('http://' + window.location.host);
  socket.on('widget', function (data) {
  	for(item in data) {
      if(item === 'nextBus') {
        var buses = data[item].data;
        var c = buses.length;


        while(c--) {
          console.log('buses', buses[c]);
          addMarker(buses[c]);
        }

      }else {
        $('#'+item).html(data[item].markup);
      }
  	}
  });


</script>

</body>
</html>
